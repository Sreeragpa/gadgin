<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GADGIN</title>
    <link rel="icon" type="image/PNG" href="stylesheet\img\gadgin.png">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Bootstrap -->
    <!-- Stylesheets -->

    <!-- Stylesheets -->
    <!-- Fontawesome -->
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <!-- Fontawesome -->
    <link href="https://cdn.jsdelivr.net/npm/boosted@5.3.2/dist/css/boosted.min.css" rel="stylesheet"
        integrity="sha384-fyenpx19UpfUhZ+SD9o9IdxeIJKE6upKx0B54OcXy1TqnO660Qw9xw6rOASP+eir" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheet/main.css">
    <link rel="stylesheet" href="/stylesheet/homestyle.css">
    <link rel="stylesheet" href="/stylesheet/accountspage.css">
    <link rel="stylesheet" href="/stylesheet/cartstyle.css">
    <link rel="stylesheet" href="/stylesheet/userorderstyle.css">

</head>

<body>

    <!-- Header Starts -->
    <%-include('include/_header')%>
        <!-- Header Ends -->


        <!-- MAIN -->
        <div>
                       <!-- Sweetalert -->
                       <div id="sweetalert-overlay-modal" class="sweetalert-overlay-modal">
                        <div id="sweetalert-modal" class="sweetalert-modal">
                            <p class="text-white fw-bold mt-2">Do you want to Cancel Order</p>
                            <div>
                                <button id="yesBtn" class="m-0 okBtn">Yes</button>
                                <button id="noBtn" class="m-0 okBtn">No</button>
        
                            </div>
                            <!-- <button id="cancelBtn">No</button> -->
                        </div>
                    </div>
                    <!-- Sweetalert -->

            <div class="container-fluid p-0 main-div">
                <!-- Content -->
                <div class="inner-content-div-user text-white">

                    <!-- Order Heading -->
                    <div class="cart-heading gap-2">
                        <div class="">
                            <h4 class="m-0">Order #<%=orders.orderid%>
                            </h4>
                        </div>
                        <div>

                        </div>
                    </div>
                    <hr>
                    <!-- / Order Heading -->

                    <!-- Order Content -->
                    <div class="order-content">
                        <!-- Order Info -->
                        <div class="order-details-u">
                            <div class="order-details-u-inner">
                                <div class="order-details-u-address">
                                    <ul>
                                        <li>Payment Method:<%=orders.paymentmethod%>
                                        </li>
                                        <li>Order Date:<%= new Date(orders.orderdate).toLocaleString('en-IN') %></li>
                                        <li>Order Items:<%=orders.orderquantity%>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="order-details-u-inner">
                                <div class="order-details-u-address">
                                    <p>Delivery Address</p>
                                    <div class="address-inner">
                                        <ul>
                                            <li>Name: <%=orders.address.name%>
                                            </li>
                                            <li>House: <%=orders.address.house%>
                                            </li>
                                            <li>PIN: <%=orders.address.pincode%>
                                            </li>
                                            <li>Phone: <%=orders.address.phone%>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- / Order Info -->

                        <!-- Order Items -->
                        <div class="order-items">
                            <!-- Order-item-card -->
                            <%for(let i=0;i<orders.orderitems.length;i++){%>
                                <a href="/">
                                    <div class="order-item-card">
                                        <div class="order-item-card-one">
                                            <div class="order-item-card-one-images row">

                                                <img src="<%=orders.orderitems[i].images[0]%>"
                                                    class="img-fluid col-12 p-0 ">


                                            </div>
                                            <div class="order-details-one ">
                                                <ul class="d-flex flex-column gap-1">
                                                    <li><span>
                                                            <%=orders.orderitems[i].name%>
                                                        </span> </li>
                                                    <li>Quantity:<%=orders.orderitems[i].quantity%>
                                                    </li>
                                                    <li>Color:<%=orders.orderitems[i].color%>
                                                    </li>
                                                    <li>Price:â‚¹<%=(orders.orderitems[i].price).toLocaleString('en-IN')%>
                                                    </li>
                                                    <li class="hidden text-capitalize">Order Status:
                                                        <%=orders.orderitems[i].orderstatus%>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center gap-2">
                                            <div>
                                                <ul>
                                                    <li class="visible text-capitalize">Order Status:
                                                        <%=orders.orderitems[i].orderstatus%>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="d-flex justify-content-center align-items-center">
                                                <%if(orders.orderitems[i].orderstatus=='pending' ||
                                                    orders.orderitems[i].orderstatus=='ordered' ){%>
                                                    <form
                                                        action="/api/order/cancel/<%=orders._id%>/<%=orders.orderitems[i].pid%>"
                                                        method="post" class="order-cancel-form m-0" id="order-cancel-form">
                                                        <button class="return-button">Cancel</button>
                                                    </form>

                                                    <%}%>
                                            </div>
                                        </div>
                                    </div>
                                    <%}%>
                                        <!-- Order-item-card -->
                                </a>

                        </div>
                        <!-- Order Items -->

                    </div>
                    <!-- /Order Content -->


                </div>

                <!-- /Content -->
                <!-- MODAL -->
                <div id="continue-overlay">
                    <div id="modal">
                        <p>An Item in your Cart is Out of Stock</p>
                        <button id="cancelBtn">Ok</button>
                    </div>
                </div>
                <!-- MODAL -->
            </div>
        </div>
        <!-- /MAIN -->



        <!-- Footer -->
        <%- include('include/_footer') %>
            <!-- Footer -->

            <script>
                const overlay = document.getElementById('continue-overlay');
                document.getElementById('preventbtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    overlay.style.display = 'flex';
                    document.getElementById('cancelBtn').addEventListener('click', (e) => {
                        overlay.style.display = '';
                    })
                })
            </script>

            <script>
                let alertmodal = document.getElementById('sweetalert-overlay-modal');

                document.querySelectorAll('.order-cancel-form').forEach((cancelform) => {
                    cancelform.addEventListener('submit', (e) => {
                        e.preventDefault();
                        alertmodal.style.display = 'flex';
                        document.getElementById('yesBtn').addEventListener('click', () => {
                            cancelform.submit();
                        })
                        document.getElementById('noBtn').addEventListener('click', () => {
                            alertmodal.style.display = 'none';
                        })

                    });


                })
            </script>

</body>

</html>